<!-- æ–‡ä»¶å: admin.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ç®¡ç†ç”»é¢ - ç¥æˆ¸å¤–å›½äººç”Ÿæ´»ã‚¬ã‚¤ãƒ‰</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* è½»é‡å¸ƒå±€ï¼Œä»…é™æœ¬é¡µï¼›ä¸ä¸å…¨ç«™ style.css å†²çª */
    .admin-tabs { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
    .tab-btn { padding: 8px 12px; border-radius: 8px; background:#e8f1fb; border:none; cursor:pointer; }
    .tab-btn.active { background:#0a66c2; color:#fff; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .admin-layout { display: grid; grid-template-columns: 260px 1fr; gap: 16px; }
    .admin-side, .admin-main, .box {
      background:#fff; border:1px solid #e6e6e6; border-radius:10px; padding:12px;
    }
    .shop-item { padding:8px; border-radius:6px; cursor:pointer; }
    .shop-item:hover { background:#f3f7ff; }
    .shop-item.active { background:#e8f1fb; font-weight:700; }
    .comment-row { border-top:1px solid #eee; padding:10px 0; }
    .row-actions { margin-top:6px; display:flex; gap:8px; flex-wrap:wrap; }
    .muted { color:#777; font-size:12px; }
    .toolbar { display:flex; gap:8px; align-items:center; margin-bottom:10px; flex-wrap:wrap; }
    .toolbar input[type="text"] { max-width: 280px; }
    .pager { margin-top:10px; display:flex; gap:8px; align-items:center; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { border-bottom:1px solid #eee; padding:8px; text-align:left; vertical-align: top; }
    .role-badge { display:inline-block; padding:2px 8px; border-radius:999px; background:#eef; font-size:12px; }
    .role-admin { background:#ffe6e6; color:#a30000; }
    .role-user  { background:#e6f3ff; color:#004a99; }
    .inline-btn { padding:6px 10px; border:none; border-radius:6px; cursor:pointer; background:#0a66c2; color:#fff; }
    .inline-btn.danger { background:#a30000; }
    .inline-btn.secondary { background:#666; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ›  ç®¡ç†ç”»é¢</h1>
    <nav class="navbar">
      <a href="index.html" class="btn">ğŸ  ãƒ›ãƒ¼ãƒ </a>
      <a href="procedure.html" class="btn">ğŸ“„ æ‰‹ç¶šãã‚¬ã‚¤ãƒ‰</a>
      <a href="map.html" class="btn">ğŸ—ºï¸ ãƒãƒƒãƒ—</a>
      <a href="review.html" class="btn">â­ ãƒ¬ãƒ“ãƒ¥ãƒ¼</a>
      <a href="login.html" class="btn">ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</a>
    </nav>
  </header>

  <main>
    <section class="intro">
      <h2>ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</h2>
      <p>ã‚³ãƒ¡ãƒ³ãƒˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸€å…ƒç®¡ç†ã—ã¾ã™ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚</p>
      <div id="statusBar" style="text-align:center;padding:6px;background:#f0f4f8;color:#333;font-size:14px;margin-top:8px;">
        èªè¨¼æ¤œè¨¼ä¸­â€¦
      </div>
    </section>

    <!-- é¡¶éƒ¨æ ‡ç­¾ -->
    <div class="admin-tabs">
      <button class="tab-btn active" data-tab="tab-comments">ğŸ“ ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†</button>
      <button class="tab-btn" data-tab="tab-users">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</button>
    </div>

    <!-- ====== è¯„è®ºç®¡ç† ====== -->
    <section id="tab-comments" class="tab-panel active">
      <div class="admin-layout">
        <!-- å·¦ï¼šåº—é“ºåˆ—è¡¨ï¼ˆæ¥è‡ª CSVï¼‰ -->
        <aside class="admin-side">
          <h3 style="margin-top:0;">åº—èˆ—ä¸€è¦§</h3>
          <div class="toolbar">
            <input id="shopSearch" type="text" placeholder="åº—åã§æ¤œç´¢â€¦" />
            <button id="reloadShops" class="btn-submit" style="padding:6px 10px;">å†èª­è¾¼</button>
          </div>
          <div id="shopList"></div>
        </aside>

        <!-- å³ï¼šè¯„è®ºåˆ—è¡¨ -->
        <section class="admin-main">
          <h3 style="margin-top:0;">ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ <span id="currentShopName" class="muted"></span></h3>
          <div class="toolbar">
            <button id="refreshComments" class="btn-submit" style="padding:6px 10px;">æ›´æ–°</button>
            <span class="muted">1ãƒšãƒ¼ã‚¸ 10ä»¶</span>
          </div>
          <div id="commentList"></div>
          <div class="pager">
            <button id="prevPage" class="btn-submit" style="padding:6px 10px;">å‰ã¸</button>
            <button id="nextPage" class="btn-submit" style="padding:6px 10px;">æ¬¡ã¸</button>
            <span id="pageInfo" class="muted"></span>
          </div>
        </section>
      </div>
    </section>

    <!-- ====== ç”¨æˆ·ç®¡ç†ï¼ˆåŸºäº Firestore users é›†åˆï¼‰ ====== -->
    <section id="tab-users" class="tab-panel">
      <div class="box">
        <h3 style="margin-top:0;">Firestore ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h3>
        <div class="toolbar">
          <input id="userSearch" type="text" placeholder="email / uid ã§æ¤œç´¢â€¦" />
          <button id="reloadUsers" class="btn-submit" style="padding:6px 10px;">å†èª­è¾¼</button>
        </div>

        <div style="overflow:auto;">
          <table class="table" id="userTable">
            <thead>
              <tr>
                <th>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th>
                <th>UID</th>
                <th>æ¨©é™</th>
                <th>ä½œæˆæ—¥æ™‚</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="userTbody">
              <tr><td colspan="5"><small>èª­ã¿è¾¼ã¿ä¸­â€¦</small></td></tr>
            </tbody>
          </table>
        </div>
        <p class="muted" style="margin-top:8px;">â€» ã“ã“ã§ã®å¤‰æ›´ã¯ Firestore ã® <code>users/{uid}</code> æ–‡æ›¸ã«å¯¾ã—ã¦è¡Œã‚ã‚Œã¾ã™ï¼ˆAuthentication ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ã¯å«ã¿ã¾ã›ã‚“ï¼‰ã€‚</p>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 ç¥æˆ¸å¤–å›½äººæ”¯æ´ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</p>
  </footer>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- PapaParse for CSVï¼ˆä¸ map.html ä¸€è‡´ï¼‰ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    /* ===== Firebase åˆå§‹åŒ– ===== */
    const firebaseConfig = {
      apiKey: "AIzaSyB8dt1NgMhBtKlUeFzCAzImuKKjzKCrOTM",
      authDomain: "kobe-life-guide.firebaseapp.com",
      projectId: "kobe-life-guide",
      storageBucket: "kobe-life-guide.firebasestorage.app",
      messagingSenderId: "440390213094",
      appId: "1:440390213094:web:508d4e03409ca338b54a27"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    /* ===== é¡¶éƒ¨æ ‡ç­¾åˆ‡æ¢ ===== */
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    /* ===== æƒé™æ ¡éªŒï¼ˆæœ¬åœ° + Firestore äºŒæ¬¡ç¡®è®¤ï¼‰ ===== */
    const statusBar = document.getElementById("statusBar");
    const localRole = localStorage.getItem("auth_role") || "user";
    const localEmail = localStorage.getItem("auth_email") || "";
    const localUid = localStorage.getItem("auth_uid") || "";

    statusBar.textContent = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ${localEmail || "æœª"}ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ¨©é™: ${localRole}ï¼‰ / Firestoreæ¤œè¨¼ä¸­â€¦`;

    async function verifyAdmin() {
      if (!localUid) return false;
      try {
        const snap = await db.collection("users").doc(localUid).get();
        const role = snap.exists ? (snap.data().role || "user") : "user";
        localStorage.setItem("auth_role", role);
        statusBar.textContent = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ${localEmail || "æœª"}ï¼ˆæ¨©é™: ${role}ï¼‰`;
        return role === "admin";
      } catch (e) {
        console.warn("ãƒ­ãƒ¼ãƒ«æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", e);
        statusBar.textContent = `æ¨©é™æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
        return false;
      }
    }

    // é admin æ‹¦æˆª
    async function guard() {
      const ok = await verifyAdmin();
      if (!ok) {
        alert("ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ã¦ãã ã•ã„ã€‚");
        window.location.href = "login.html?redirectTo=admin.html";
      }
    }
    guard();

    /* ====================== è¯„è®ºç®¡ç† ====================== */

    // åº—é“ºåˆ—è¡¨ï¼ˆæ¥è‡ª Google è¡¨æ ¼ï¼Œä¸ map.html ç›¸åŒæºï¼‰
    const shopCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRdoRvyh8AKmNq032tjbaVhv0nEhjsrWD-r0dQopKqu0z6RjDN5BJ2tCX5-Z3CnlKiDuyBn7lPiGBh/pub?gid=0&single=true&output=csv";
    const shopListEl = document.getElementById("shopList");
    const shopSearchEl = document.getElementById("shopSearch");
    const reloadShopsBtn = document.getElementById("reloadShops");
    const currentShopNameEl = document.getElementById("currentShopName");

    let shops = [];  // {id,name,description,link,image,lat,lng}
    let filteredShops = [];
    let currentShopId = null;
    let currentShopName = "";

    function renderShops(list) {
      shopListEl.innerHTML = "";
      list.forEach(s => {
        const div = document.createElement("div");
        div.className = "shop-item" + (s.id === currentShopId ? " active" : "");
        div.textContent = s.name || s.id || "(ç„¡å)";
        div.title = s.description || "";
        div.addEventListener("click", () => {
          currentShopId = s.id || s.name;
          currentShopName = s.name || s.id || "";
          Array.from(shopListEl.children).forEach(el => el.classList.remove("active"));
          div.classList.add("active");
          currentShopNameEl.textContent = currentShopName ? `ï¼ˆ${currentShopName}ï¼‰` : "";
          resetPaging();
          loadCommentsPage();
        });
        shopListEl.appendChild(div);
      });
    }

    function fetchShops() {
      Papa.parse(shopCsvUrl, {
        download: true,
        header: true,
        complete: ({ data }) => {
          shops = data
            .filter(row => row && (row.id || row.name))
            .map(row => ({
              id: (row.id && row.id.trim()) || (row.name && row.name.trim()) || "",
              name: row.name || "",
              description: row.description || "",
              link: row.link || "",
              image: row.image || "",
              lat: row.lat, lng: row.lng
            }));
          filteredShops = shops;
          renderShops(filteredShops);
        }
      });
    }
    fetchShops();

    shopSearchEl.addEventListener("input", () => {
      const kw = shopSearchEl.value.trim().toLowerCase();
      filteredShops = shops.filter(s =>
        (s.name || "").toLowerCase().includes(kw) ||
        (s.description || "").toLowerCase().includes(kw)
      );
      renderShops(filteredShops);
    });
    reloadShopsBtn.addEventListener("click", fetchShops);

    // è¯„è®ºåˆ†é¡µ
    const commentListEl = document.getElementById("commentList");
    const refreshBtn = document.getElementById("refreshComments");
    const prevBtn = document.getElementById("prevPage");
    const nextBtn = document.getElementById("nextPage");
    const pageInfoEl = document.getElementById("pageInfo");

    const PAGE_SIZE = 10;
    let pageStack = [];
    let lastVisible = null;
    let pageIndex = 0;

    function resetPaging() {
      pageStack = [];
      lastVisible = null;
      pageIndex = 0;
      pageInfoEl.textContent = "";
      commentListEl.innerHTML = "";
    }

    async function loadCommentsPage(direction = "stay") {
      if (!currentShopId) {
        commentListEl.innerHTML = "<small>å·¦å´ã‹ã‚‰åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</small>";
        return;
      }

      let ref = db.collection("shops").doc(currentShopId).collection("comments")
                  .orderBy("time", "desc").limit(PAGE_SIZE);

      if (direction === "next" && lastVisible) {
        ref = ref.startAfter(lastVisible);
      } else if (direction === "prev") {
        if (pageStack.length >= 2) {
          pageStack.pop();
          const prevCursor = pageStack[pageStack.length - 1];
          if (prevCursor) ref = ref.startAfter(prevCursor);
          pageIndex = Math.max(0, pageIndex - 1);
        } else {
          pageIndex = 0;
        }
      } else {
        if (lastVisible) ref = ref.startAfter(lastVisible);
      }

      const snap = await ref.get();
      commentListEl.innerHTML = "";

      if (snap.empty) {
        commentListEl.innerHTML = "<small>ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</small>";
        nextBtn.disabled = true;
        prevBtn.disabled = pageIndex <= 0;
        pageInfoEl.textContent = `ãƒšãƒ¼ã‚¸ ${pageIndex + 1}`;
        return;
      }

      snap.forEach(doc => {
        const d = doc.data();
        const t = d.time?.toDate ? d.time.toDate() : new Date();
        const timeStr = `${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,'0')}`;
        const stars = "â˜…".repeat(d.rating || 0) + "â˜†".repeat(5 - (d.rating || 0));

        const row = document.createElement("div");
        row.className = "comment-row";
        row.innerHTML = `
          <div><strong>${d.name || "åŒ¿å"}</strong> <span class="muted">ï¼ˆ${timeStr}ï¼‰</span></div>
          <div class="muted">${d.email ? `æŠ•ç¨¿: ${d.email}` : ""}</div>
          <div><span class="stars">${stars}</span></div>
          <div>${d.text || ""}</div>
          <div class="row-actions">
            <button class="inline-btn" data-action="edit" data-id="${doc.id}">ç·¨é›†</button>
            <button class="inline-btn danger" data-action="del" data-id="${doc.id}">å‰Šé™¤</button>
          </div>
        `;
        commentListEl.appendChild(row);
      });

      lastVisible = snap.docs[snap.docs.length - 1];
      pageStack.push(lastVisible);
      if (direction === "next") pageIndex += 1;

      prevBtn.disabled = pageIndex <= 0;
      nextBtn.disabled = snap.size < PAGE_SIZE;
      pageInfoEl.textContent = `ãƒšãƒ¼ã‚¸ ${pageIndex + 1}`;
    }

    nextBtn.addEventListener("click", () => loadCommentsPage("next"));
    prevBtn.addEventListener("click", () => loadCommentsPage("prev"));
    refreshBtn.addEventListener("click", () => { resetPaging(); loadCommentsPage(); });

    // ç¼–è¾‘ / åˆ é™¤è¯„è®º
    commentListEl.addEventListener("click", async (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      if (!currentShopId || !id) return;

      const ref = db.collection("shops").doc(currentShopId).collection("comments").doc(id);

      if (action === "del") {
        if (!confirm("ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        try {
          await ref.delete();
          alert("å‰Šé™¤ã—ã¾ã—ãŸã€‚");
          resetPaging(); loadCommentsPage();
        } catch (err) {
          console.error("å‰Šé™¤å¤±æ•—:", err);
          alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }
      } else if (action === "edit") {
        try {
          const snap = await ref.get();
          if (!snap.exists) return alert("ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
          const d = snap.data();
          const newText = prompt("ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†ã—ã¦ãã ã•ã„ï¼š", d.text || "");
          if (newText === null) return;
          let newRating = d.rating || 0;
          const inputRating = prompt("è©•ä¾¡ï¼ˆ1ã€œ5ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š", String(newRating));
          if (inputRating !== null) {
            const r = parseInt(inputRating, 10);
            if (!isNaN(r) && r >= 1 && r <= 5) newRating = r;
          }
          await ref.update({ text: newText.trim(), rating: newRating });
          alert("æ›´æ–°ã—ã¾ã—ãŸã€‚");
          resetPaging(); loadCommentsPage();
        } catch (err) {
          console.error("æ›´æ–°å¤±æ•—:", err);
          alert("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }
      }
    });

    /* ====================== ç”¨æˆ·ç®¡ç†ï¼ˆFirestore users é›†åˆï¼‰ ====================== */
    const userTbody = document.getElementById("userTbody");
    const userSearch = document.getElementById("userSearch");
    const reloadUsersBtn = document.getElementById("reloadUsers");

    let usersCache = [];  // {uid,email,role,createdAt}

    async function fetchUsers() {
      userTbody.innerHTML = `<tr><td colspan="5"><small>èª­ã¿è¾¼ã¿ä¸­â€¦</small></td></tr>`;
      try {
        const snap = await db.collection("users").orderBy("createdAt", "desc").get();
        usersCache = snap.docs.map(doc => {
          const d = doc.data() || {};
          return {
            uid: doc.id,
            email: d.email || "",
            role: d.role || "user",
            createdAt: d.createdAt?.toDate ? d.createdAt.toDate() : (d.createdAt || null)
          };
        });
        renderUsers(usersCache);
      } catch (e) {
        console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—å¤±æ•—:", e);
        userTbody.innerHTML = `<tr><td colspan="5"><small>å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</small></td></tr>`;
      }
    }

    function renderUsers(list) {
      if (!list.length) {
        userTbody.innerHTML = `<tr><td colspan="5"><small>è©²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“ã€‚</small></td></tr>`;
        return;
      }
      userTbody.innerHTML = "";
      list.forEach(u => {
        const tr = document.createElement("tr");
        const createdStr = u.createdAt
          ? `${u.createdAt.getFullYear()}/${u.createdAt.getMonth()+1}/${u.createdAt.getDate()}`
          : "-";
        tr.innerHTML = `
          <td>${u.email || "-"}</td>
          <td class="muted">${u.uid}</td>
          <td>
            <span class="role-badge ${u.role === "admin" ? "role-admin" : "role-user"}">${u.role}</span>
          </td>
          <td class="muted">${createdStr}</td>
          <td>
            <button class="inline-btn secondary" data-action="makeUser"  data-uid="${u.uid}">user ã«ã™ã‚‹</button>
            <button class="inline-btn"           data-action="makeAdmin" data-uid="${u.uid}">admin ã«ã™ã‚‹</button>
            <button class="inline-btn danger"    data-action="deleteDoc" data-uid="${u.uid}">Firestore æ–‡æ›¸å‰Šé™¤</button>
          </td>
        `;
        userTbody.appendChild(tr);
      });
    }

    userSearch.addEventListener("input", () => {
      const kw = userSearch.value.trim().toLowerCase();
      const filtered = usersCache.filter(u =>
        (u.email || "").toLowerCase().includes(kw) ||
        (u.uid || "").toLowerCase().includes(kw)
      );
      renderUsers(filtered);
    });

    reloadUsersBtn.addEventListener("click", fetchUsers);

    // ç”¨æˆ·æ“ä½œï¼šæ”¹è§’è‰² / åˆ é™¤ Firestore æ–‡æ¡£
    userTbody.addEventListener("click", async (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      const action = btn.dataset.action;
      const uid = btn.dataset.uid;
      if (!uid) return;

      const ref = db.collection("users").doc(uid);

      try {
        if (action === "makeAdmin") {
          await ref.set({ role: "admin" }, { merge: true });
          alert("æ¨©é™ã‚’ admin ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚");
        } else if (action === "makeUser") {
          await ref.set({ role: "user" }, { merge: true });
          alert("æ¨©é™ã‚’ user ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚");
        } else if (action === "deleteDoc") {
          if (!confirm("Firestore ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–‡æ›¸ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆAuthentication ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ï¼‰")) return;
          await ref.delete();
          alert("Firestore ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–‡æ›¸ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
        }
        // å˜æ›´ååˆ·æ–°
        fetchUsers();
        // å¦‚æœåŠ¨åˆ°äº†è‡ªå·±ï¼Œåˆ·æ–°é¡¶éƒ¨çŠ¶æ€æ¡
        if (uid === localUid) verifyAdmin();
      } catch (err) {
        console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¤±æ•—:", err);
        alert("æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    });

    // åˆæ¬¡åŠ è½½
    fetchUsers();
  </script>
</body>
</html>