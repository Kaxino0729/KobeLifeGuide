<!-- 文件名：review.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>コメント - 留学生の声</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>💬 留学生のコメント</h1>

  <nav class="navbar">
    <a href="index.html" class="btn">🏠 ホーム</a>
    <a href="procedure.html" class="btn">📄 手続きガイド</a>
    <a href="map.html" class="btn">🗺️ マップ</a>
    <a href="review.html" class="btn">⭐ レビュー</a>
    <a href="login.html" class="btn">🔐 ログイン</a>
    <a href="admin.html" class="btn admin-only">🛠 管理</a>
  </nav>

  <!-- 评论表单 -->
  <form id="commentForm">
    <label for="name">お名前（任意）</label>
    <input type="text" id="name" placeholder="例：リュウさん" />

    <label for="comment">コメント内容</label>
    <textarea id="comment" rows="4" placeholder="生活の悩みや、便利だったことなどを教えてください"></textarea>

    <button type="submit" class="btn-submit">送信</button>
  </form>

  <!-- 评论列表 -->
  <section class="comment-list" id="commentList"></section>

  <!-- 管理员区块（示例，普通用户看不到） -->
  <section class="card admin-only" style="margin-top:20px;">
    <h3>🛠 管理者ツール</h3>
    <p>ここからコメントの編集・削除を追加できます（サンプル）。</p>
  </section>

  <footer>
    <p>&copy; 2025 神戸外国人支援プロジェクト</p>
  </footer>

  <script>
    const form = document.getElementById("commentForm");
    const commentList = document.getElementById("commentList");

    // 保存评论到 localStorage
    const saveComment = (name, comment) => {
      const data = JSON.parse(localStorage.getItem("comments") || "[]");
      data.unshift({ name, comment, time: new Date().toLocaleString() });
      localStorage.setItem("comments", JSON.stringify(data));
    };

    // 渲染评论
    const renderComments = () => {
      const data = JSON.parse(localStorage.getItem("comments") || "[]");
      commentList.innerHTML = data.map(c => `
        <div class="comment">
          <div class="name">🧑 ${c.name || "匿名"} 
            <span style="font-weight:normal; color:#999; font-size:12px;">（${c.time}）</span>
          </div>
          <div class="text">${c.comment}</div>
        </div>
      `).join("");
    };

    // 提交表单
    form.addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const comment = document.getElementById("comment").value.trim();
      if (!comment) return alert("コメント内容を入力してください。");
      saveComment(name, comment);
      form.reset();
      renderComments();
    });

    renderComments();

    /* ===== 页面联动：显示登录状态 / 隐藏 admin-only ===== */
    (function () {
      const email = localStorage.getItem("auth_email");
      const role  = localStorage.getItem("auth_role");

      if (email) {
        const bar = document.createElement("div");
        bar.style.textAlign = "center";
        bar.style.padding = "6px";
        bar.style.background = "#f0f4f8";
        bar.style.color = "#333";
        bar.style.fontSize = "14px";
        bar.textContent = `ログイン中: ${email}（役割: ${role || "user"}）`;
        document.body.prepend(bar);

        if (role !== "admin") {
          document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
        }
      } else {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
      }
    })();
  </script>
</body>
</html>