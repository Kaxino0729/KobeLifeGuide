<!-- 文件名：review.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>コメント - 留学生の声</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>💬 留学生のコメント</h1>

  <nav class="navbar">
      <a href="index.html" class="btn">🏠 ホーム</a>
      <a href="procedure.html" class="btn">📄 手続きガイド</a>
      <a href="map.html" class="btn">🗺️ マップ</a>
      <a href="review.html" class="btn">⭐ レビュー</a>
      <a href="search.html" class="btn">🔎 検索</a>
      <a href="profile.html" class="btn">👤 プロフィール</a>
      <a href="login.html" class="btn">🔐 ログイン</a>
      <a href="admin.html" class="btn admin-only">🛠 管理</a>
  </nav>

  <p>留学生の生活の中で感じたこと、困ったこと、改善してほしいことなどを共有してください。</p>

  <div id="comment-section">
    <h2>📝 コメント投稿</h2>
    <form id="commentForm">
      <label for="name">お名前（任意）</label>
      <input type="text" id="name" placeholder="例：リュウさん" />

      <label for="comment">コメント内容</label>
      <textarea id="comment" rows="4" placeholder="生活の悩みや、便利だったことなど"></textarea>

      <button type="submit">投稿</button>
    </form>
  </div>

  <div id="comment-list">
    <h2>📌 コメント一覧</h2>
    <ul id="comments"></ul>
  </div>

  <script>
    const form = document.getElementById("commentForm");
    const nameInput = document.getElementById("name");
    const commentInput = document.getElementById("comment");
    const commentList = document.getElementById("comments");

    // localStorage に保存されたコメントを取得
    let comments = JSON.parse(localStorage.getItem("review_comments")) || [];

    // コメント表示
    function renderComments() {
      commentList.innerHTML = "";
      comments.forEach((c) => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${c.name || "匿名"}:</strong> ${c.comment}`;
        commentList.appendChild(li);
      });
    }

    // コメント投稿
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const comment = commentInput.value.trim();
      if (!comment) {
        alert("コメント内容を入力してください。");
        return;
      }
      comments.push({ name, comment });
      localStorage.setItem("review_comments", JSON.stringify(comments));
      form.reset();
      renderComments();
    });

    renderComments();

    /* ===== 页面联动：显示登录状态 / 隐藏 admin-only ===== */
    (function () {
      const email = localStorage.getItem("auth_email");
      const role  = localStorage.getItem("auth_role");

      if (email) {
        const bar = document.createElement("div");
        bar.style.textAlign = "center";
        bar.style.padding = "6px";
        bar.style.background = "#f0f4f8";
        bar.style.color = "#333";
        bar.style.fontSize = "14px";
        bar.textContent = `ログイン中: ${email}（役割: ${role || "user"}）`;
        document.body.prepend(bar);

        if (role !== "admin") {
          document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
        }
      } else {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
      }
    })();
  </script>

  <!-- Firebase (for auth-guard stability) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <!-- 登录拦截 -->
  <script src="auth-guard.js"></script>

  <!-- 统一 admin 权限补丁 -->
  <script src="auth-util.js"></script>
  <script>
    AuthUtil.refreshRoleAndApplyAdminUI();
  </script>
</body>
</html>
